<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>seisflows3.system.slurm &mdash; SeisFlows3  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/sf3_globe_alpha.png"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> SeisFlows3
            <img src="../../../../_static/sf3_globe_alpha_wide.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../start_here.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../citeme.html">Cite</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Structure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../command_line_tool.html">Commmand Line Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../parameter_file.html">Parameter File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_directory.html">Working Directory Structure</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../specfem2d_example.html">Specfem2D workstation example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../extending.html">Extending SeisFlows3</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code_dev_plan.html">Code Development Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">SeisFlows3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">seisflows3.system.slurm</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/autoapi/seisflows3/system/slurm/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-seisflows3.system.slurm">
<span id="seisflows3-system-slurm"></span><h1><a class="reference internal" href="#module-seisflows3.system.slurm" title="seisflows3.system.slurm"><code class="xref py py-mod docutils literal notranslate"><span class="pre">seisflows3.system.slurm</span></code></a><a class="headerlink" href="#module-seisflows3.system.slurm" title="Permalink to this headline"></a></h1>
<p>The Simmple Linux Utility for Resource Management (SLURM) is a commonly used
workload manager on many high performance computers / clusters. The Slurm
system class provides generalized utilites for interacting with Slurm systems.</p>
<dl class="simple">
<dt>Useful commands for figuring out system-specific required parameters</dt><dd><p>$ sinfo –Node –long  # Determine the cores-per-node for partitions</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The main development system for SeisFlows3 used SLURM. Therefore the other
system supers will not be up to date until access to those systems are
granted. This rosetta stone, for converting from SLURM to other workload
management tools will be useful: <a class="reference external" href="https://slurm.schedmd.com/rosetta.pdf">https://slurm.schedmd.com/rosetta.pdf</a></p>
</div>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline"></a></h2>
<div class="section" id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline"></a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#seisflows3.system.slurm.Slurm" title="seisflows3.system.slurm.Slurm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Slurm</span></code></a></p></td>
<td><p>Generalized interface for submitting jobs to and interfacing with a SLURM</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline"></a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#seisflows3.system.slurm.job_id_list" title="seisflows3.system.slurm.job_id_list"><code class="xref py py-obj docutils literal notranslate"><span class="pre">job_id_list</span></code></a>(stdout, single)</p></td>
<td><p>Parses job id list from sbatch standard output. Stdout typically looks</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#seisflows3.system.slurm.job_array_status" title="seisflows3.system.slurm.job_array_status"><code class="xref py py-obj docutils literal notranslate"><span class="pre">job_array_status</span></code></a>(job_ids)</p></td>
<td><p>Determines current status of job or job array</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#seisflows3.system.slurm.check_job_state" title="seisflows3.system.slurm.check_job_state"><code class="xref py py-obj docutils literal notranslate"><span class="pre">check_job_state</span></code></a>(job_id)</p></td>
<td><p>Queries completion status of a single job by running:</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline"></a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#seisflows3.system.slurm.PAR" title="seisflows3.system.slurm.PAR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PAR</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#seisflows3.system.slurm.PATH" title="seisflows3.system.slurm.PATH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PATH</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<dl class="py data">
<dt class="sig sig-object py" id="seisflows3.system.slurm.PAR">
<span class="sig-prename descclassname"><span class="pre">seisflows3.system.slurm.</span></span><span class="sig-name descname"><span class="pre">PAR</span></span><a class="headerlink" href="#seisflows3.system.slurm.PAR" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="seisflows3.system.slurm.PATH">
<span class="sig-prename descclassname"><span class="pre">seisflows3.system.slurm.</span></span><span class="sig-name descname"><span class="pre">PATH</span></span><a class="headerlink" href="#seisflows3.system.slurm.PATH" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="seisflows3.system.slurm.Slurm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">seisflows3.system.slurm.</span></span><span class="sig-name descname"><span class="pre">Slurm</span></span><a class="headerlink" href="#seisflows3.system.slurm.Slurm" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-obj docutils literal notranslate"><span class="pre">custom_import</span></code>(<code class="xref py py-obj docutils literal notranslate"><span class="pre">'system'</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">'cluster'</span></code>)</p>
<p>Generalized interface for submitting jobs to and interfacing with a SLURM
workload management system.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="seisflows3.system.slurm.Slurm.logger">
<span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#seisflows3.system.slurm.Slurm.logger" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="seisflows3.system.slurm.Slurm.required">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">required</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#seisflows3.system.slurm.Slurm.required" title="Permalink to this definition"></a></dt>
<dd><p>A hard definition of paths and parameters required by this class,
alongside their necessity for the class and their string explanations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="seisflows3.system.slurm.Slurm.submit">
<span class="sig-name descname"><span class="pre">submit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">submit_call</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#seisflows3.system.slurm.Slurm.submit" title="Permalink to this definition"></a></dt>
<dd><p>Submits workflow as a single process master job</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>workflow</strong> (<em>module</em>) – </p></li>
<li><p><strong>submit_call</strong> (<em>str</em>) – subclasses (e.g., specific SLURM cluster subclasses)
can overload the sbatch command line input by setting
submit_call. If set to None, default submit_call will be set here.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="seisflows3.system.slurm.Slurm.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">classname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_call</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#seisflows3.system.slurm.Slurm.run" title="Permalink to this definition"></a></dt>
<dd><p>Runs task multiple times in embarrassingly parallel fasion on a SLURM
cluster. Executes classname.method(<a href="#id1"><span class="problematic" id="id2">*</span></a>args, <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs) <cite>NTASK</cite> times,
each time on <cite>NPROC</cite> CPU cores</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The actual CLI call structure looks something like this
$ sbatch –args scripts/run OUTPUT class method environs</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>classname</strong> (<em>str</em>) – the class to run</p></li>
<li><p><strong>method</strong> (<em>str</em>) – the method from the given <cite>classname</cite> to run</p></li>
<li><p><strong>single</strong> (<em>bool</em>) – run a single-process, non-parallel task, such as
smoothing the gradient, which only needs to be run by once.
This will change how the job array and the number of tasks is
defined, such that the job is submitted as a single-core job to
the system.</p></li>
<li><p><strong>run_call</strong> (<em>str</em>) – subclasses (e.g., specific SLURM cluster subclasses)
can overload the sbatch command line input by setting
run_call. If set to None, default run_call will be set here.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="seisflows3.system.slurm.Slurm.taskid">
<span class="sig-name descname"><span class="pre">taskid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#seisflows3.system.slurm.Slurm.taskid" title="Permalink to this definition"></a></dt>
<dd><p>Provides a unique identifier for each running task</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>identifier for a given task</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="seisflows3.system.slurm.job_id_list">
<span class="sig-prename descclassname"><span class="pre">seisflows3.system.slurm.</span></span><span class="sig-name descname"><span class="pre">job_id_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stdout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#seisflows3.system.slurm.job_id_list" title="Permalink to this definition"></a></dt>
<dd><p>Parses job id list from sbatch standard output. Stdout typically looks
like: ‘Submitted batch job 441636’, but if submitting jobs cross-cluster
(e.g., like on Maui), stdout might be:
‘Submitted batch job 441636 on cluster Maui’</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to find the job number, we just scan each word in stdout
until we find the number, ASSUMING that there is only one number in
the string</p>
</div>
<p>TODO Should failing to return job_id break in reasonable way?</p>
<p>The output job arrays will look something like:
[44163_0, 44163_1, …, 44163_PAR.NTASK]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stdout</strong> (<em>str</em>) – the text response from running ‘sbatch’ on SLURM, which
should be returned by subprocess.run(stdout=PIPE)</p></li>
<li><p><strong>single</strong> (<em>bool</em>) – if running a single process job, returns a list of length
1 with a single job id, else returns a list of length PAR.NTASK
for all arrayed jobs</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>list</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a list of array jobs that should be currently running</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="seisflows3.system.slurm.job_array_status">
<span class="sig-prename descclassname"><span class="pre">seisflows3.system.slurm.</span></span><span class="sig-name descname"><span class="pre">job_array_status</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job_ids</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#seisflows3.system.slurm.job_array_status" title="Permalink to this definition"></a></dt>
<dd><p>Determines current status of job or job array</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job_ids</strong> (<em>list</em>) – list of SLURM job id numbers to check completion of
Will not return unless all jobs have completed</p>
</dd>
<dt class="field-even">Rtype is_done</dt>
<dd class="field-even"><p>bool</p>
</dd>
<dt class="field-odd">Return is_done</dt>
<dd class="field-odd"><p>True if all jobs in the array have been completed</p>
</dd>
<dt class="field-even">Rtype states</dt>
<dd class="field-even"><p>list</p>
</dd>
<dt class="field-odd">Return states</dt>
<dd class="field-odd"><p>list of states returned from sacct</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="seisflows3.system.slurm.check_job_state">
<span class="sig-prename descclassname"><span class="pre">seisflows3.system.slurm.</span></span><span class="sig-name descname"><span class="pre">check_job_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#seisflows3.system.slurm.check_job_state" title="Permalink to this definition"></a></dt>
<dd><dl>
<dt>Queries completion status of a single job by running:</dt><dd><p>$ sacct -nL -o jobid,state -j {job_id}</p>
<p># Example outputs from this sacct command
# JOB_ID    STATUS
441630_0  PENDING  # array job will have the array number
441630    COMPLETED  # if –array=0-0, jobs will not have suffix
441628.batch    COMPLETED  # we don’t want to check these</p>
</dd>
</dl>
<p>Available job states: <a class="reference external" href="https://slurm.schedmd.com/sacct.html">https://slurm.schedmd.com/sacct.html</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>-L flag in sacct queries all available clusters, not just the
cluster that ran the <cite>sacct</cite> call
-X supress the .batch and .extern jobname</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> (<em>str</em>) – job id to query</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SeisFlows3 Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>